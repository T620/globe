{% extends 'base.html' %}
{% block content %}

<section class="upload-main">
	<div class="container">
		<div class="row">
			<div class="col">
				<div class="card">
					<div class="card-head">
						<h1 class="text-center">Upload A Panorama</h1>
						<h4 class="text-center subtitle">Tell us a bit about your image</h4>
					</div>
					<form action="/upload/" method="post">

						<div class="card-body">
							<label for="image">Choose a panorama to upload</label>
							<input type="file" name="image" value="Select..."/>

							<input type="hidden" name="location" id="location" />
							<p>Drop a pin on the map to select where you took the photo.</p>
							<div id="map" style="width: 50%; height: 25%; padding: 10%;"></div>
							<p>Or, enter manually:</p>

						</div>

						<div class="card-footer">
							<input type="submit" class="btn btn-primary" value="Upload" />
						</div>

					</form>
				</div><!--/card-->
			</div>
		</div>
	</div>
</section>

<div id="form">
      <table>
      <tr><td>Name:</td> <td><input type='text' id='name'/> </td> </tr>
      <tr><td>Address:</td> <td><input type='text' id='address'/> </td> </tr>
      <tr><td>Type:</td> <td><select id='type'> +
                 <option value='bar' SELECTED>bar</option>
                 <option value='restaurant'>restaurant</option>
                 </select> </td></tr>
                 <tr><td></td><td><input type='button' value='Save' onclick='saveData()'/></td></tr>
      </table>
    </div>
    <div id="message">Location saved</div>



<script>
      var map;
      var marker;
      var infowindow;
      var messagewindow;

      function initMap() {
        var california = {lat: 37.4419, lng: -122.1419};
        map = new google.maps.Map(document.getElementById('map'), {
          center: california,
          zoom: 13
        });

        infowindow = new google.maps.InfoWindow({
          content: document.getElementById('form')
        });

        messagewindow = new google.maps.InfoWindow({
          content: document.getElementById('message')
        });

        google.maps.event.addListener(map, 'click', function(event) {
          marker = new google.maps.Marker({
            position: event.latLng,
            map: map
          });


          google.maps.event.addListener(marker, 'click', function() {
            //infowindow.open(map, marker);

			var latlng = marker.getPosition();
			//console.log(position.lat());

			var lat = latlng.lat();
			var lo = latlng.lng();

			var coords = $.extend(lat, lo);
			console.log(coords);
			$('#location').val(coords);

			map.panTo(coords);
          });
        });
      }

    </script>

    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key={{key}}&callback=initMap">
    </script>


{% endblock %}
