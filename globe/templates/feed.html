{% extends 'base.html' %}
{% block content %}

<script src="/static/js/upload.js"></script>

<section class="remodal-bg">
	<div class="container no-padding" id="feed-main_controls">
		<div class="row no-gutters" style="width:100%;">
			<div class="col-xs-12 col-sm-3">
				<div class="card filter">
					<h3>Filter Posts</h3>
					<form action="/feed/filter/" method="post">
						<div class="form-check-wrapper">
							<div class="form-check">
								<input checked class="form-check-input" id="exampleRadios1" name=
								"exampleRadios" type="radio" value="option1"> <label class=
								"form-check-label" for="exampleRadios1">Your Feed</label>
							</div>
							<div class="form-check">
								<input checked class="form-check-input" id="exampleRadios1" name=
								"exampleRadios" type="radio" value="option1"> <label class=
								"form-check-label" for="exampleRadios1">Trending</label>
							</div>
							<div class="form-check">
								<input checked class="form-check-input" id="exampleRadios1" name=
								"exampleRadios" type="radio" value="option1"> <label class=
								"form-check-label" for="exampleRadios1">Country</label>
							</div>
						</div>
					</form>
				</div><!--/filter-->
				<div id="minimise-filter">

				</div>
			</div>
			<!--
			<div class="col-xs-12 col-sm-7 m-l-4">
				<div class="card" id="feed-upload">
					<div class="card-head">
						<img class="profile-thumb" height="50px" src=
						"/static/img/default_profile.jpg" width="50px"> <a href=
						"/user/1">Josh</a>
					</div>
					<div class="card-body">
						<form action="/post/" class="tiny-form" method="post" enctype="multipart/form-data">
							<div class="col-xs-4">
								<label for="country">Where have you been recently?</label>
								<div class="inline">
									<input class="form-control" name="country" placeholder="Cairo, Egpyt"
									type="text">
									<button type="submit" class="btn btn-primary">Share</button>
								</div>
							</div>
						</form>
					</div>
				</div>
				<div id="minimise-upload">

				</div>
			</div>
		-->
		</div><!--/row-->
	</div><!--/feed-main_controls-->
</section>

<a href="#modal">
	<div class="fab">
		+
	</div>
</a>
<div class="fab-mini">
	-
</div>

<section class="remodal-bg" id="feed-main_posts">
	<div class="container">
		<div class="row align-items-center justify-content-center">
			{% for post in posts %}
			<div class="col-xs-12">
				<div class="card">
					<div class="card-head social-head">
						<div class="profile-img">
							<img class="img img-circle profile-thumb" height="50px" src="/static/img/default_profile.jpg" width="50px">
						</div>
						<div class="profile-creds">
							<div class="profile-name">
								<a href="/user/1">Josh</a>
							</div>
							<div class="post-loc">
								<i class="fa fa-map-marker"></i> {{post.city}}
							</div>
						</div>
					</div>
					<div class="card-body">
						<iframe allowfullscreen height="400" src=
						"https://cdn.pannellum.org/2.3/pannellum.htm#panorama=https://{{post.image}}"
						style="border-style:none;" width="600"></iframe>
					</div>
					<div class="card-footer">
						<div class="caption">
							<p>{{post.postContent}}</p>
						</div>
						<div class="controls">
							<ul>
								<li><i class="far fa-heart"></i></li>
								<li><i class="far fa-comment-alt"></i></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			{% endfor %}
		</div><!--/row-->
	</div>
	<div class="remodal" data-remodal-id="modal">
		<button class="remodal-close" data-remodal-action="close"></button>
		<form class="no-style" id="form-main" method="post" action="/post/" enctype="multipart/form-data">
			<div id="remodal-wrapper">
				<div id="form-stage-1" class="form-visible">
					<h3>New Post</h3>
					<p>First things first. Is your image 3D or 2D?</p><br>
					<img src="/static/img/3d-model.svg" />
					<br />
					<a href="#0" class="btn btn-outline-primary" onClick="chooseImageType('panorama')">3D</a>
					<div id="select-pano" class="form-hidden">
						<i class="fa fa-tick text-success"></i>
						Selected
					</div>
					<br />
					<img src="/static/img/2d-model.svg" />
					<br />
					<a href="#0" class="btn btn-outline-primary mb-2" onClick="chooseImageType('2d')">2D</a>

					<div class="form-hidden" id="select-2d">
						<i class="fa fa-tick text-success"></i>
						Selected
					</div>
					<br />
					<a class="text-tiny text-center m-t-2 mb-2" href="#0">I'm not sure.</a><br>
					<input type="hidden" value="" name="image-type" id="image-type"></input>
				</div>
				<div id="form-stage-2" class="form-hidden">
					<h3>Choose an image</h3>
					<p>Upload an image and tell your audience what it's about.</p>
					<div class="card-body text-center">
						<div class="form-group">
							<label for="image">Choose an image to upload</label>
							<br />
							<input type="file" required class="form-control text-center" name="image"/>
						</div>
						<div class="form-group">
							<label for="desc">Share your thoughts</label>
							<input type="text" class="form-control text-left" name="desc" />
						</div>
					</div>
				</div><!--/stage-2-->
				<div id="form-stage-3" class="form-hidden">
					<div class="form-group m-t-1">
						<p>Drop a pin on the map to select where you took the photo.</p>
						<div id="map" style="width: 100%; height: 40%; padding: 25%;"></div>
					</div>
					<div class="form-group">
						<label for="location-city">Check the city is correct:</label>
						<input type="text" id="location-city" name="location-city" required class="form-control" placeholder="Aberdeen">

						<input type="hidden" class="form-control" id="location-coords" name="location-coords"></input>
					</div>
				</div>

				<a href="#0" class="btn btn-danger" id="btn-previous" data-prev-stage=0 onclick="triggerPrevStage();">Cancel</a>

				<a href="#0" class="btn btn-disabled" id="btn-next" data-next-stage=2 onclick="triggerNextStage();">Next</a>

				<button class="btn btn-primary form-hidden" id="btn-submit"> Upload </button>
			</div><!--/remodal-wrapper-->
		</form>
	</div>
</section>


<div id="choose-pin">
    <a href="#0" onclick="choose();" class="btn btn-primary">Select</a>
</div>

<script>
	var map;
	var marker;
	var infowindow;
	var messagewindow;

	function initMap() {
		//console.log(geocoder);
		var edinburgh = {
			lat: 55.936894769039434,
			lng: -3.1640625
		};
		map = new google.maps.Map(document.getElementById('map'), {
			center: edinburgh,
			zoom: 13
		});

		infowindow = new google.maps.InfoWindow({
			content: document.getElementById('choose-pin')
		});
		messagewindow = new google.maps.InfoWindow({
			content: document.getElementById('message')
		});
		google.maps.event.addListenerOnce(map, 'click', function(event) {
			marker = new google.maps.Marker({
			position: event.latLng,
			map: map
		});
		google.maps.event.addListener(marker, 'click', function() {
			infowindow.open(map, marker);
			var latlng = marker.getPosition();
		});
	});
};

	function choose(geocoder){
		var latlng = marker.getPosition();
		var lattitude = latlng.lat();
		var longitude = latlng.lng();
		//console.log(lattitude, longitude);

		var coords = lattitude + ", " + longitude;

		//success msg
		$('#choose-pin').html(
			"<i class='fa fa-check text-success'></i>"
		);

		console.log("placing coords into input");
		$('#location-coords').val(coords);

		return geocodeLatLng();
	}

	function geocodeLatLng() {
		var geocoder = new google.maps.Geocoder;

		var input = $('#location-coords').val();
		console.log("read from input: " + input);
		var latlngStr = input.split(',', 2);

        var latlng = {lat: parseFloat(latlngStr[0]), lng: parseFloat(latlngStr[1])};

		console.log("reading from geocoder func: " + latlng.lat);

		geocoder.geocode({'location': latlng}, function(results, status) {
	    	if (status === 'OK') {
	            if (results[0]) {
				  //grab the city
				  city = results[0].address_components[3].long_name;
				  console.log(city);
	              $('#location-city').val(city);
	            }
				else {
	              window.alert('No results found');
	            }
	          }
			  else {
	            window.alert('Geocoder failed due to: ' + status);
	          }
	    });
	 }


</script>

    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key={{key}}&callback=initMap">
    </script>
{% endblock %}
